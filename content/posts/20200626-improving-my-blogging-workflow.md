---
title: "Improving My Blogging Workflow"
slug: "improving my blogging workflow"
date: 2020-06-26T16:00:00-05:00
draft: false
publishdate: 2020-06-26T16:00:00-05:00
tags:
- command-line
- how-to
---

I am always trying to improve my workflows. I want to automate all repetitive tasks and focus only on actual work. For this blog the work is writing. The repetitive tasks are publishing and backups.

My blog is a set of markdown files and a few static assets. The site is statically generated by [Hugo][1]. I am happy with the setup. Markdown eliminates friction. I have a blank draft ready to go. I can quickly duplicate the file and start writing anytime inspiration strikes. The site is currently built every two hours. This is initiated by a cron job and a bash script.

```
0 */2 * * * bash /var/www/mnml.blog/hugo.sh
```
```
#!/bin/sh
 
 OUTPUT=/home/mnml.log"
 HUGO=/home/linuxbrew/.linuxbrew/bin/hugo
 
 cd /var/www/mnml.blog/
 date >> $OUTPUT
 /home/linuxbrew/.linuxbrew/bin/hugo --minify >> $OUTPUT 2>&1

exit 0
```
My publishing workflow is write, test on local server, copy to production server. I write in [BBEdit][2] and [Textastic][3]. Hugo has a nice feature for testing. A Hugo server can be created locally by opening a terminal, then navigating to your local site directory and running 
```
hugo -F server
```

By default this creates a local webserver on port 1313 that automatically reloads content as it is changed. The -F is optional. It shows future posts.

After reviewing the posts on various web browsers I copy the markdown files to my production server. I have done this various ways. The two most common are through the built-in SFTP in Textastic for iOS and using [FileZilla][4] on macOS. I store the canonical copy of my posts in iCloud Drive so that they are accessible from all my devices. I run my local Hugo server on my main MacBook. It serves as the test site and a backup location for my posts. My MacBook is also regularly backed up to a local external harddrive and remotely via [BackBlaze][5].

Copying files between the three main storage places and ensuring that they are in sync is not difficult but it does require time and diligence. I wanted to make this quicker and essentially foolproof. I decided to use [rsync][6]. 

>rsync is an open source utility that provides fast incremental file transfer. rsync is freely available under the GNU General Public License and is currently being maintained by Wayne Davison.

The rsync utility can perform the same functions as cp and scp but is more efficient because it only copies differences to files. To sync my posts between iCloud Drive and my test server I run the following command in the terminal

```
rsync -avz ~/Library/Mobile Documents/M6HJR9W95L~com~textasticapp~textastic/Documents/posts/ ~/Sites/mnml.blog/content/posts/
```
This copies any changes from the iCloud Drive storage location to the test site. The files are compressed and sent in archive mode preserving their properties. To sync files with the remote production server the previous command is updated as follows:

```
rsync -avz ~/Sites/mnml.blog/content/posts/ remote_server:/var/www/mnml.blog/content/posts/
```

I created aliases for these commands in my zsh profile. Rather than sync posts to the production server I sync the entire site. This is very fast. It takes less than one second because only changes are sent. It ensures that I don't forget an image or configuration change.

![Improved Workflow](/img/improved-blogging-workflow.jpg)

[1]: https://gohugo.io
[2]: http://www.barebones.com/products/bbedit/index.html
[3]: https://www.textasticapp.com
[4]: https://filezilla-project.org
[5]: https://www.backblaze.com
[6]: https://rsync.samba.org
